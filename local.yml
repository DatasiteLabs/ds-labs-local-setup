# yaml-language-server: $schema=https://raw.githubusercontent.com/ansible-community/schemas/main/f/ansible-playbook.json
---
- hosts: all
  vars:
    source_key: "./.ssh/id_rsa"
    dest_key: "{{ lookup('env', 'HOME') }}/.ssh/id_rsa"
    # https://github.com/Homebrew/install/blob/master/install.sh for details on `brew prefex`,
    # only available post install
    homebrew_prefix: "{{ (ansible_machine == 'arm64') | ternary('/opt/homebrew', '/usr/local') }}"
    datasite_home: "{{ lookup('env','DATASITE_HOME') }}"
  vars_prompt:
    - name: ds_email
      prompt: Enter your Datasite email
      private: false
    - name: github_access_token
      prompt: "Github access token with scopes: public-key"
  #   - name: user_pw
  #     prompt: Enter your users password
  #     unsafe: true
  #     private: true
  #     confirm: true
  pre_tasks:
    - assert:
        that: datasite_home | length > 2
  tasks:
    - name: Read machine hostname var
      ansible.builtin.shell: hostname
      register: machine_hostname
    - set_fact: machine_hostname={{ machine_hostname.stdout }}
    - include: tasks/osx.yml
      when: ansible_facts['os_family'] == "Darwin"
    #  - include: tasks/ssh.yml # noqa comments-indentation
